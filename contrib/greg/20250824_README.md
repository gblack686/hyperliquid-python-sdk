# Greg's Hyperliquid Examples
**Last Updated: 2025-08-24**

A comprehensive collection of custom examples for interacting with the Hyperliquid DEX using Python SDK, including account monitoring, order execution, and Supabase integration.

## Prerequisites

1. Install dependencies:
```bash
pip install hyperliquid-python-sdk python-dotenv colorama supabase
```

2. Configure your `.env` file in the parent directory with:
```env
# Hyperliquid Configuration
HYPERLIQUID_API_KEY=your_api_private_key_here
ACCOUNT_ADDRESS=your_main_account_address_here
NETWORK=MAINNET_API_URL

# Supabase Configuration (for data sync)
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key
```

## Available Scripts

### Account Management & Monitoring

#### 1. `get_started.py`
**Purpose**: Initial setup verification and connection test
- Validates API configuration
- Connects to Hyperliquid
- Shows account balance and positions
- Lists available trading assets

**Usage**:
```bash
python greg-examples/get_started.py
```

#### 2. `check_account.py`
**Purpose**: Comprehensive account overview
- Shows perpetual account details (balance, margin, positions)
- Displays spot balances
- Lists open orders
- Shows fee structure
- Provides detailed position information with PnL

**Usage**:
```bash
python greg-examples/check_account.py
```

#### 3. `dashboard_v2.py`
**Purpose**: Enhanced trading dashboard with accurate calculations
- **Correct margin calculations** using actual API response structure
- Real-time account value and leverage display
- Position tracking with liquidation distances
- Health score calculation
- Auto-refresh capability

**Key Features**:
- Actual leverage calculation: `actual_leverage = total_ntl_pos / account_value`
- Margin usage percentage: `margin_usage_pct = (total_margin_used / account_value * 100)`
- Health scoring based on margin usage and leverage
- Liquidation distance monitoring

**Usage**:
```bash
# Single view
python greg-examples/dashboard_v2.py

# Auto-refresh every 10 seconds
python greg-examples/dashboard_v2.py --refresh 10
```

### Order Execution & Testing

#### 4. `order_execution_test.py`
**Purpose**: Comprehensive order testing suite with safety features
- Interactive menu for all order operations
- **Safety limits**: Max 10 size per order, max 5 concurrent orders
- Supports limit orders, market orders, order modification, cancellation
- Bracket orders and scaled orders
- Complete order lifecycle testing

**Key API Changes Fixed**:
- Uses `name` parameter instead of `coin` for Exchange methods
- Proper error handling for minimum order values ($10)
- Price validation and rounding

**Usage**:
```bash
# Interactive menu (MAINNET - requires confirmation)
python greg-examples/order_execution_test.py --menu

# Use testnet for safe testing
python greg-examples/order_execution_test.py --testnet --menu
```

#### 5. `quick_order_manager.py`
**Purpose**: Simplified command-line tool for quick order operations
- Show open orders
- Place limit buy/sell orders
- Cancel specific orders or all orders
- Close positions with limit or market orders
- Windows-compatible (no Unicode issues)

**Commands**:
```bash
# Show open orders
python greg-examples/quick_order_manager.py show

# Place buy order (1% below market)
python greg-examples/quick_order_manager.py buy --coin HYPE --size 1 --offset 1

# Place sell order (1% above market)
python greg-examples/quick_order_manager.py sell --coin HYPE --size 1 --offset 1

# Cancel all HYPE orders
python greg-examples/quick_order_manager.py cancel --coin HYPE

# Cancel ALL orders (requires confirmation)
python greg-examples/quick_order_manager.py cancel-all

# Close position with limit order
python greg-examples/quick_order_manager.py close --coin HYPE --offset 0.1

# Close position with market order
python greg-examples/quick_order_manager.py close --coin HYPE --market
```

#### 6. `test_orders.py`
**Purpose**: Automated test script for verifying order operations
- Tests connection and account retrieval
- Places and cancels test orders
- Verifies minimum order value requirements
- Checks position information

**Usage**:
```bash
python greg-examples/test_orders.py
```

### Data Persistence & Analytics

#### 7. `supabase_sync.py`
**Purpose**: Sync Hyperliquid data to Supabase database
- Automatic data synchronization every 60 seconds
- Tracks dashboard snapshots, positions, orders, and fills
- Health score calculation and risk monitoring
- Complete audit trail with timestamps

**Data Tracked**:
- **hl_dashboard**: Account snapshots with health scores
- **hl_positions**: Position details with PnL tracking
- **hl_orders**: Order management with status updates
- **hl_fills**: Complete trade history

**Usage**:
```bash
# Run once
python greg-examples/supabase_sync.py --once

# Continuous sync (default 60s)
python greg-examples/supabase_sync.py

# Custom interval (30 seconds)
python greg-examples/supabase_sync.py --interval 30

# Run in background (Windows)
start /B python greg-examples/supabase_sync.py --interval 60
```

### Trading Strategies

#### 8. `monitor_and_trade.py`
**Purpose**: Automated monitoring with conditional trading
- Monitors account metrics continuously
- Places orders based on conditions
- Includes safety thresholds

#### 9. `buy_hype_50.py`
**Purpose**: Simple buy order example
- Buys $50 worth of HYPE
- Shows order execution flow

## Important Findings & Fixes (2025-08-24)

### API Parameter Changes
- **CRITICAL**: The Exchange class methods use `name` parameter, not `coin`
  - ❌ Wrong: `exchange.order(coin="HYPE", ...)`
  - ✅ Correct: `exchange.order(name="HYPE", ...)`
  - Applies to: `order()`, `cancel()`, `market_open()`, `market_close()`

### Order Requirements
- **Minimum order value**: $10 (enforced by exchange)
- **Price validation**: Orders too far from market price are rejected
- **Order types**: Use `{"limit": {"tif": "Gtc"}}` for Good Till Cancel orders

### Windows Compatibility
- Removed Unicode characters (✓, ✗) that cause encoding errors
- Replaced with text alternatives ([OK], [X])
- Ensures scripts run properly on Windows terminals

### Margin Calculations
- **Actual leverage formula**: `actual_leverage = total_ntl_pos / account_value`
- **Margin usage**: `margin_usage_pct = (total_margin_used / account_value * 100)`
- **Free margin**: `free_margin = account_value - total_margin_used`
- **Liquidation buffer**: `liquidation_buffer_pct = ((account_value - maintenance_margin) / account_value * 100)`

### Health Score Algorithm
```python
def calculate_health_score(margin_usage: float, leverage: float) -> tuple:
    health_score = 100
    
    # Deduct for margin usage
    if margin_usage > 80: health_score -= 40; status = "CRITICAL"
    elif margin_usage > 60: health_score -= 25; status = "WARNING"
    elif margin_usage > 40: health_score -= 10; status = "MODERATE"
    
    # Deduct for leverage
    if leverage > 10: health_score -= 30
    elif leverage > 5: health_score -= 15
    elif leverage > 3: health_score -= 5
    
    return health_score, status
```

## Testing Results (2025-08-24)

### Successfully Tested Operations
1. ✅ API connection and authentication
2. ✅ Account value retrieval ($20,151.62)
3. ✅ Price fetching (HYPE: $44.16, BTC: $115,130.50)
4. ✅ Order placement (0.5 HYPE @ $35.33, Order ID: 142982707028)
5. ✅ Order cancellation
6. ✅ Position retrieval (LONG 2464.21 HYPE)
7. ✅ Supabase data synchronization
8. ✅ Dashboard calculations and health scoring

### Known Issues & Solutions
1. **Issue**: "Order has invalid price" error
   - **Solution**: Keep orders within reasonable range of market price (~5-10%)

2. **Issue**: Unicode encoding errors on Windows
   - **Solution**: All scripts updated to use ASCII characters only

3. **Issue**: Minimum order value rejection
   - **Solution**: Ensure all orders have value ≥ $10

## Project Structure
```
greg-examples/
├── 20250824_README.md          # This documentation (with date)
├── README.md                    # Main documentation
├── README_SUPABASE.md          # Supabase integration guide
├── .env                        # Configuration (DO NOT COMMIT)
├── check_account.py            # Account overview
├── dashboard_v2.py             # Enhanced dashboard with correct calculations
├── order_execution_test.py     # Comprehensive order testing
├── quick_order_manager.py      # Command-line order tool
├── test_orders.py              # Automated test script
├── supabase_sync.py           # Database synchronization
└── [other scripts...]          # Additional utilities
```

## Safety Guidelines

1. **API Key Security**: 
   - Never commit `.env` files
   - Use read-only keys where possible
   - Rotate keys regularly

2. **Order Safety**:
   - Start with small test orders
   - Use the safety limits in scripts
   - Test on testnet first when available

3. **Risk Management**:
   - Monitor health scores regularly
   - Keep margin usage below 60%
   - Use stop losses for large positions

## Troubleshooting

### Connection Issues
```bash
# Test basic connectivity
python greg-examples/verify_connection.py

# Check account details
python greg-examples/check_account.py
```

### Order Issues
- Ensure minimum $10 order value
- Check price is within valid range
- Verify sufficient account balance
- Use correct parameter names (`name` not `coin`)

### Supabase Issues
- Verify credentials in `.env`
- Check table creation in Supabase dashboard
- Monitor sync logs for errors

## Support

For SDK-specific issues, refer to the [official Hyperliquid Python SDK documentation](https://github.com/hyperliquid-dex/hyperliquid-python-sdk).

## Changelog

### 2025-08-24
- Fixed API parameter naming (coin → name)
- Added comprehensive order execution testing
- Implemented Supabase data synchronization
- Created enhanced dashboard with accurate calculations
- Resolved Windows Unicode compatibility issues
- Added minimum order value validation
- Documented health score algorithm
- Created command-line order management tools