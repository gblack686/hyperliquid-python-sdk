<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper Trading Dashboard | Hyperliquid Strategies</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lightweight-charts@4.2.2/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>Paper Trading Dashboard</h1>
                <span class="subtitle">Hyperliquid Strategy Performance</span>
            </div>
            <div class="header-right">
                <div class="status-indicator" id="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Live</span>
                </div>
                <div class="last-updated" id="last-updated">
                    Updated: --
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="dashboard" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab-btn" data-tab="docs" onclick="switchTab('docs')">Documentation</button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="tab-dashboard" class="tab-content active">

        <!-- Overview Cards -->
        <section class="overview-section">
            <div class="card metric-card">
                <div class="metric-label">Total Signals (24h)</div>
                <div class="metric-value" id="total-signals">--</div>
                <div class="metric-sub" id="signals-breakdown">Loading...</div>
            </div>
            <div class="card metric-card">
                <div class="metric-label">Win Rate</div>
                <div class="metric-value" id="win-rate">--%</div>
                <div class="metric-sub" id="win-loss">-- W / -- L</div>
            </div>
            <div class="card metric-card">
                <div class="metric-label">Total P&L (24h)</div>
                <div class="metric-value" id="total-pnl">$--</div>
                <div class="metric-sub" id="pnl-pct">--%</div>
            </div>
            <div class="card metric-card">
                <div class="metric-label">Active Signals</div>
                <div class="metric-value" id="active-signals">--</div>
                <div class="metric-sub" id="active-breakdown">Loading...</div>
            </div>
        </section>

        <!-- Strategy Performance -->
        <section class="strategy-section">
            <h2>Strategy Performance (24h)</h2>
            <div class="strategy-grid">
                <div class="card strategy-card" id="funding-card">
                    <div class="strategy-header">
                        <span class="strategy-icon">$</span>
                        <span class="strategy-name">Funding Arbitrage</span>
                    </div>
                    <div class="strategy-stats">
                        <div class="stat">
                            <span class="stat-label">Signals</span>
                            <span class="stat-value" id="funding-signals">--</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Win Rate</span>
                            <span class="stat-value" id="funding-winrate">--%</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">P&L</span>
                            <span class="stat-value" id="funding-pnl">$--</span>
                        </div>
                    </div>
                    <div class="strategy-bar">
                        <div class="bar-fill" id="funding-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="card strategy-card" id="grid-card">
                    <div class="strategy-header">
                        <span class="strategy-icon">#</span>
                        <span class="strategy-name">Grid Trading</span>
                    </div>
                    <div class="strategy-stats">
                        <div class="stat">
                            <span class="stat-label">Signals</span>
                            <span class="stat-value" id="grid-signals">--</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Win Rate</span>
                            <span class="stat-value" id="grid-winrate">--%</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">P&L</span>
                            <span class="stat-value" id="grid-pnl">$--</span>
                        </div>
                    </div>
                    <div class="strategy-bar">
                        <div class="bar-fill" id="grid-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="card strategy-card" id="momentum-card">
                    <div class="strategy-header">
                        <span class="strategy-icon">^</span>
                        <span class="strategy-name">Directional Momentum</span>
                    </div>
                    <div class="strategy-stats">
                        <div class="stat">
                            <span class="stat-label">Signals</span>
                            <span class="stat-value" id="momentum-signals">--</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Win Rate</span>
                            <span class="stat-value" id="momentum-winrate">--%</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">P&L</span>
                            <span class="stat-value" id="momentum-pnl">$--</span>
                        </div>
                    </div>
                    <div class="strategy-bar">
                        <div class="bar-fill" id="momentum-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Live Signal Feed -->
        <section class="signal-feed-section">
            <div class="section-header">
                <h2>Signal Feed</h2>
                <div class="feed-header-right">
                    <span class="feed-live-indicator"><span class="feed-live-dot"></span> Live</span>
                    <span class="badge" id="feed-count">0</span>
                </div>
            </div>
            <div class="card signal-feed-card">
                <div class="signal-feed" id="signal-feed">
                    <div class="feed-empty">Waiting for signals...</div>
                </div>
            </div>
        </section>

        <!-- Market Charts -->
        <section class="charts-section">
            <div class="section-header">
                <h2>Market Charts</h2>
            </div>
            <div class="card charts-card">
                <div class="charts-controls">
                    <div class="ticker-tabs">
                        <button class="ticker-btn active" data-ticker="BTC" onclick="selectTicker('BTC')">BTC</button>
                        <button class="ticker-btn" data-ticker="SOL" onclick="selectTicker('SOL')">SOL</button>
                        <button class="ticker-btn" data-ticker="ETH" onclick="selectTicker('ETH')">ETH</button>
                        <button class="ticker-btn" data-ticker="XRP" onclick="selectTicker('XRP')">XRP</button>
                        <button class="ticker-btn" data-ticker="HYPE" onclick="selectTicker('HYPE')">HYPE</button>
                    </div>
                    <div class="tf-tabs">
                        <button class="tf-btn" data-tf="15m" onclick="selectTimeframe('15m')">15m</button>
                        <button class="tf-btn active" data-tf="1h" onclick="selectTimeframe('1h')">1h</button>
                        <button class="tf-btn" data-tf="4h" onclick="selectTimeframe('4h')">4h</button>
                        <button class="tf-btn" data-tf="1d" onclick="selectTimeframe('1d')">1d</button>
                    </div>
                </div>
                <div class="chart-price-label">
                    <span id="chart-ticker-name">BTC</span>
                    <span id="chart-current-price" class="price">--</span>
                    <span id="chart-price-change" class="pnl">--</span>
                </div>
                <div id="candlestick-chart" class="chart-container"></div>
                <div id="volume-chart" class="chart-container chart-volume"></div>
            </div>
        </section>

        <!-- P&L Equity Curve -->
        <section class="pnl-curve-section">
            <div class="section-header">
                <h2>Cumulative P&L</h2>
                <div class="pnl-controls">
                    <div class="pnl-tf-tabs">
                        <button class="pnl-tf-btn active" data-pnltf="7d" onclick="selectPnlTimeframe('7d')">7D</button>
                        <button class="pnl-tf-btn" data-pnltf="30d" onclick="selectPnlTimeframe('30d')">30D</button>
                        <button class="pnl-tf-btn" data-pnltf="all" onclick="selectPnlTimeframe('all')">All</button>
                    </div>
                </div>
            </div>
            <div class="card charts-card">
                <div class="pnl-summary">
                    <div class="pnl-total">
                        <span class="pnl-total-label">Total P&L</span>
                        <span class="pnl-total-value" id="pnl-curve-total">$--</span>
                    </div>
                    <div class="pnl-stats">
                        <span class="pnl-stat" id="pnl-curve-trades">-- trades</span>
                        <span class="pnl-stat" id="pnl-curve-winrate">--% win rate</span>
                        <span class="pnl-stat" id="pnl-curve-best">Best: $--</span>
                        <span class="pnl-stat" id="pnl-curve-worst">Worst: $--</span>
                    </div>
                </div>
                <div id="pnl-curve-chart" class="chart-container" style="height:300px"></div>
            </div>
        </section>

        <!-- Strategy Comparison -->
        <section class="comparison-section">
            <div class="section-header">
                <h2>Strategy Comparison</h2>
                <span class="badge" id="comparison-period">All Time</span>
            </div>
            <div class="card table-card">
                <table class="data-table" id="comparison-table">
                    <thead>
                        <tr>
                            <th>Strategy</th>
                            <th>Signals</th>
                            <th>Win Rate</th>
                            <th>Total P&L</th>
                            <th>Avg P&L</th>
                            <th>Best</th>
                            <th>Worst</th>
                            <th>Avg Hold</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="comparison-tbody">
                        <tr><td colspan="9" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Enhanced Analytics (QuantPyLib) -->
        <section class="analytics-section">
            <h2>Enhanced Analytics</h2>
            <div class="strategy-grid">
                <div class="card metric-card">
                    <div class="metric-label">Sharpe Ratio (30d)</div>
                    <div class="metric-value" id="sharpe-ratio">--</div>
                    <div class="metric-sub" id="sharpe-quality">--</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-label">Sortino Ratio (30d)</div>
                    <div class="metric-value" id="sortino-ratio">--</div>
                    <div class="metric-sub" id="sortino-quality">--</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-label">Max Drawdown (30d)</div>
                    <div class="metric-value" id="max-drawdown">--%</div>
                    <div class="metric-sub" id="drawdown-quality">--</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-label">Profit Factor (30d)</div>
                    <div class="metric-value" id="profit-factor">--</div>
                    <div class="metric-sub" id="factor-quality">--</div>
                </div>
            </div>
        </section>

        <!-- Active Signals Table -->
        <section class="signals-section">
            <div class="section-header">
                <h2>Active Signals</h2>
                <span class="badge" id="active-count">0</span>
            </div>
            <div class="card table-card">
                <table class="data-table" id="active-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Strategy</th>
                            <th>Symbol</th>
                            <th>Direction</th>
                            <th>Entry</th>
                            <th>Target</th>
                            <th>Stop</th>
                            <th>Confidence</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="active-tbody">
                        <tr><td colspan="9" class="loading">Loading signals...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Recent Outcomes Table -->
        <section class="outcomes-section">
            <div class="section-header">
                <h2>Recent Outcomes (24h)</h2>
                <span class="badge" id="outcomes-count">0</span>
            </div>
            <div class="card table-card">
                <table class="data-table" id="outcomes-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Strategy</th>
                            <th>Symbol</th>
                            <th>Direction</th>
                            <th>Outcome</th>
                            <th>P&L %</th>
                            <th>P&L $</th>
                            <th>Duration</th>
                        </tr>
                    </thead>
                    <tbody id="outcomes-tbody">
                        <tr><td colspan="8" class="loading">Loading outcomes...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Backtest Results -->
        <section class="backtests-section">
            <div class="section-header">
                <h2>Recent Backtests</h2>
                <span class="badge" id="backtests-count">0</span>
            </div>
            <div class="card table-card">
                <table class="data-table" id="backtests-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Engine</th>
                            <th>Formula / Strategy</th>
                            <th>Tickers</th>
                            <th>Return</th>
                            <th>Sharpe</th>
                            <th>Max DD</th>
                            <th>Win Rate</th>
                        </tr>
                    </thead>
                    <tbody id="backtests-tbody">
                        <tr><td colspan="8" class="loading">No backtests yet</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Auto-Tuner Adjustments -->
        <section class="adjustments-section">
            <div class="section-header">
                <h2>Strategy Auto-Tuner</h2>
                <span class="badge" id="adjustments-count">0</span>
            </div>
            <div class="card table-card">
                <table class="data-table" id="adjustments-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Strategy</th>
                            <th>Parameter</th>
                            <th>Change</th>
                            <th>Reason</th>
                            <th>7d Context</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="adjustments-tbody">
                        <tr><td colspan="7" class="loading">No adjustments yet</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        </div><!-- end tab-dashboard -->

        <!-- Documentation Tab -->
        <div id="tab-docs" class="tab-content">
            <div class="docs-container">

                <!-- System Overview -->
                <section class="docs-section">
                    <h2 class="docs-heading">System Overview</h2>
                    <div class="card docs-card">
                        <p>This paper trading system generates and tracks simulated trading signals on <strong>Hyperliquid perpetual futures</strong>. No real capital is at risk -- all trades are paper-only with $1,000 notional per signal.</p>
                        <div class="docs-architecture">
                            <pre class="docs-pre">
Scheduler (APScheduler)
  |
  +-- Every 15 min:  Run all strategies --> Generate recommendations
  +-- Every 5 min:   Check outcomes     --> Mark target_hit / stopped / expired
  +-- Every 1 hour:  Update metrics     --> Sharpe, Sortino, drawdown
  +-- Daily 00:00:   Daily review       --> Telegram summary
  +-- Daily 01:00:   Auto-tuner         --> Propose parameter adjustments
                            </pre>
                        </div>
                        <h3 class="docs-subheading">Signal Lifecycle</h3>
                        <div class="docs-flow">
                            <div class="flow-step">
                                <div class="flow-num">1</div>
                                <div class="flow-text"><strong>Generate</strong> -- Strategy produces a recommendation with entry, target, stop, and confidence score</div>
                            </div>
                            <div class="flow-step">
                                <div class="flow-num">2</div>
                                <div class="flow-text"><strong>Track</strong> -- System monitors price every 5 minutes against entry, target, and stop levels</div>
                            </div>
                            <div class="flow-step">
                                <div class="flow-num">3</div>
                                <div class="flow-text"><strong>Resolve</strong> -- Signal closes as TARGET_HIT (profit), STOPPED (loss), or EXPIRED (time limit)</div>
                            </div>
                            <div class="flow-step">
                                <div class="flow-num">4</div>
                                <div class="flow-text"><strong>Learn</strong> -- Auto-tuner evaluates 7-day results and adjusts strategy parameters</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Strategy: Funding Arbitrage -->
                <section class="docs-section">
                    <h2 class="docs-heading">
                        <span class="docs-icon docs-icon-funding">$</span>
                        Funding Arbitrage
                    </h2>
                    <div class="card docs-card">
                        <div class="docs-meta">
                            <span class="docs-tag">Low Risk</span>
                            <span class="docs-tag">Market Neutral</span>
                            <span class="docs-tag">High Frequency</span>
                        </div>
                        <h3 class="docs-subheading">How It Works</h3>
                        <p>Captures the funding rate differential between perpetual futures and spot price. When the funding rate is significantly positive, shorts pay longs -- the strategy goes <strong>long</strong> to collect funding. When funding is significantly negative, longs pay shorts -- the strategy goes <strong>short</strong>.</p>

                        <h3 class="docs-subheading">Entry Criteria</h3>
                        <ul class="docs-list">
                            <li>Absolute funding rate exceeds <code>min_funding_rate</code> threshold (default 0.01%)</li>
                            <li>24h trading volume above <code>min_volume</code> (default $100K, currently $120K after tuning)</li>
                            <li>Funding rate has been consistent over the last 3 intervals</li>
                        </ul>

                        <h3 class="docs-subheading">Risk Management</h3>
                        <ul class="docs-list">
                            <li><strong>Target:</strong> Funding rate mean-reversion to zero (capture the spread)</li>
                            <li><strong>Stop Loss:</strong> Price moves against position beyond 2x expected funding capture</li>
                            <li><strong>Expiry:</strong> 24 hours (funding rates reset every 8h on Hyperliquid)</li>
                        </ul>

                        <h3 class="docs-subheading">Tunable Parameters</h3>
                        <table class="docs-param-table">
                            <tr><th>Parameter</th><th>Range</th><th>Default</th><th>Purpose</th></tr>
                            <tr><td><code>min_funding_rate</code></td><td>0.002% - 0.05%</td><td>0.01%</td><td>Minimum funding rate to trigger entry</td></tr>
                            <tr><td><code>min_volume</code></td><td>$50K - $500K</td><td>$100K</td><td>Minimum 24h volume for liquidity</td></tr>
                            <tr><td><code>expiry_hours</code></td><td>4 - 48</td><td>24</td><td>Maximum signal duration</td></tr>
                        </table>

                        <h3 class="docs-subheading">Implementation</h3>
                        <pre class="docs-code">class FundingArbitrage(BaseStrategy):
    # Core logic in generate_recommendations()
    # 1. Fetch funding rates for all perpetuals
    # 2. Filter by min_funding_rate and min_volume
    # 3. Score by funding magnitude * volume rank
    # 4. Generate LONG/SHORT recommendations
    # File: scripts/paper_trading/strategies/funding_strategy.py</pre>
                    </div>
                </section>

                <!-- Strategy: Grid Trading -->
                <section class="docs-section">
                    <h2 class="docs-heading">
                        <span class="docs-icon docs-icon-grid">#</span>
                        Grid Trading
                    </h2>
                    <div class="card docs-card">
                        <div class="docs-meta">
                            <span class="docs-tag">Medium Risk</span>
                            <span class="docs-tag">Range Bound</span>
                            <span class="docs-tag">Medium Frequency</span>
                        </div>
                        <h3 class="docs-subheading">How It Works</h3>
                        <p>Identifies assets trading in a defined range using Bollinger Bands. When price approaches the lower band, the strategy goes <strong>long</strong> expecting a bounce. When price approaches the upper band, it goes <strong>short</strong> expecting mean reversion.</p>

                        <h3 class="docs-subheading">Entry Criteria</h3>
                        <ul class="docs-list">
                            <li>Asset must have a defined trading range of at least <code>min_range_pct</code> (default 3%)</li>
                            <li>Price within <code>entry_threshold_pct</code> of upper or lower Bollinger Band</li>
                            <li>Volume sufficient to ensure fills at grid levels</li>
                        </ul>

                        <h3 class="docs-subheading">Risk Management</h3>
                        <ul class="docs-list">
                            <li><strong>Target:</strong> Opposite Bollinger Band (middle band for conservative)</li>
                            <li><strong>Stop Loss:</strong> Band breakout -- price closes beyond the band by a margin</li>
                            <li><strong>Expiry:</strong> 12-29 hours (adjusted by tuner based on expiry rate)</li>
                        </ul>

                        <h3 class="docs-subheading">Tunable Parameters</h3>
                        <table class="docs-param-table">
                            <tr><th>Parameter</th><th>Range</th><th>Default</th><th>Purpose</th></tr>
                            <tr><td><code>min_range_pct</code></td><td>1.5% - 8.0%</td><td>3.0%</td><td>Minimum Bollinger Band width</td></tr>
                            <tr><td><code>entry_threshold_pct</code></td><td>10 - 40</td><td>20</td><td>% proximity to band edge for entry</td></tr>
                            <tr><td><code>expiry_hours</code></td><td>4 - 48</td><td>24</td><td>Maximum signal duration</td></tr>
                        </table>

                        <h3 class="docs-subheading">Implementation</h3>
                        <pre class="docs-code">class GridTrading(BaseStrategy):
    # Core logic in generate_recommendations()
    # 1. Compute Bollinger Bands (20-period, 2 std dev)
    # 2. Calculate band width as % of price
    # 3. Check if price is near upper/lower band
    # 4. Generate reversal signals with band targets
    # File: scripts/paper_trading/strategies/grid_strategy.py</pre>
                    </div>
                </section>

                <!-- Strategy: Directional Momentum -->
                <section class="docs-section">
                    <h2 class="docs-heading">
                        <span class="docs-icon docs-icon-momentum">^</span>
                        Directional Momentum
                    </h2>
                    <div class="card docs-card">
                        <div class="docs-meta">
                            <span class="docs-tag">Higher Risk</span>
                            <span class="docs-tag">Trend Following</span>
                            <span class="docs-tag">Lower Frequency</span>
                        </div>
                        <h3 class="docs-subheading">How It Works</h3>
                        <p>Combines multiple momentum indicators (RSI, EMA crossover, volume surge, price change) into a composite score. When the score exceeds the threshold, the strategy enters in the direction of momentum.</p>

                        <h3 class="docs-subheading">Entry Criteria</h3>
                        <ul class="docs-list">
                            <li>Composite momentum score above <code>min_score</code> (default 50, currently 55 after tuning)</li>
                            <li>Price change over lookback period exceeds <code>min_change_pct</code></li>
                            <li>Volume above <code>min_volume</code> to confirm momentum</li>
                            <li>RSI aligned with direction (not overbought for longs, not oversold for shorts)</li>
                        </ul>

                        <h3 class="docs-subheading">Scoring Components</h3>
                        <table class="docs-param-table">
                            <tr><th>Component</th><th>Weight</th><th>Signal</th></tr>
                            <tr><td>RSI (14)</td><td>25%</td><td>Below 30 = bullish, above 70 = bearish</td></tr>
                            <tr><td>EMA Cross (9/21)</td><td>25%</td><td>Fast above slow = bullish</td></tr>
                            <tr><td>Volume Surge</td><td>25%</td><td>Current > 1.5x 20-period average</td></tr>
                            <tr><td>Price Change</td><td>25%</td><td>% change over lookback period</td></tr>
                        </table>

                        <h3 class="docs-subheading">Risk Management</h3>
                        <ul class="docs-list">
                            <li><strong>Target:</strong> ATR-based (2x ATR from entry)</li>
                            <li><strong>Stop Loss:</strong> ATR-based (1x ATR from entry)</li>
                            <li><strong>Expiry:</strong> 8 hours (short-term momentum trades)</li>
                        </ul>

                        <h3 class="docs-subheading">Tunable Parameters</h3>
                        <table class="docs-param-table">
                            <tr><th>Parameter</th><th>Range</th><th>Default</th><th>Purpose</th></tr>
                            <tr><td><code>min_score</code></td><td>30 - 80</td><td>50</td><td>Minimum composite momentum score</td></tr>
                            <tr><td><code>min_change_pct</code></td><td>1.0% - 8.0%</td><td>3.0%</td><td>Minimum price change to consider</td></tr>
                            <tr><td><code>min_volume</code></td><td>$50K - $500K</td><td>$500K</td><td>Minimum volume for confirmation</td></tr>
                            <tr><td><code>expiry_hours</code></td><td>4 - 48</td><td>8</td><td>Maximum signal duration</td></tr>
                        </table>

                        <h3 class="docs-subheading">Implementation</h3>
                        <pre class="docs-code">class DirectionalMomentum(BaseStrategy):
    # Core logic in generate_recommendations()
    # 1. Fetch 1h candles for each asset
    # 2. Compute RSI, EMA cross, volume ratio, price change
    # 3. Weight components into composite score (0-100)
    # 4. Generate signal if score > min_score
    # File: scripts/paper_trading/strategies/momentum_strategy.py</pre>
                    </div>
                </section>

                <!-- Auto-Tuner -->
                <section class="docs-section">
                    <h2 class="docs-heading">Self-Adjusting Auto-Tuner</h2>
                    <div class="card docs-card">
                        <p>The auto-tuner evaluates each strategy's 7-day performance daily and proposes parameter adjustments to improve results. All changes are bounded and logged for review.</p>

                        <h3 class="docs-subheading">Tuning Rules</h3>
                        <table class="docs-param-table">
                            <tr><th>Condition</th><th>Action</th><th>Max Change</th></tr>
                            <tr><td>Win rate &lt; 30%</td><td>Tighten entry filters (raise thresholds)</td><td>+10%</td></tr>
                            <tr><td>Win rate &gt; 70%</td><td>Slightly loosen filters</td><td>-5%</td></tr>
                            <tr><td>Avg P&amp;L &lt; -1%</td><td>Raise volume filter (liquid markets only)</td><td>+20%</td></tr>
                            <tr><td>Expiry rate &gt; 50%</td><td>Extend signal duration</td><td>+20%</td></tr>
                            <tr><td>Few signals + decent WR</td><td>Loosen filters to capture more signals</td><td>-10%</td></tr>
                        </table>

                        <h3 class="docs-subheading">Safety Constraints</h3>
                        <ul class="docs-list">
                            <li>Maximum 25% change per adjustment step</li>
                            <li>All parameters have hard min/max bounds</li>
                            <li>Adjustments are PENDING until reviewed (unless auto_apply is enabled)</li>
                            <li>Full 7-day performance context logged with every adjustment</li>
                        </ul>

                        <h3 class="docs-subheading">Adjustment Lifecycle</h3>
                        <div class="docs-flow">
                            <div class="flow-step">
                                <div class="flow-num flow-pending">P</div>
                                <div class="flow-text"><strong>PENDING</strong> -- Tuner proposes change, awaiting review</div>
                            </div>
                            <div class="flow-step">
                                <div class="flow-num flow-approved">A</div>
                                <div class="flow-text"><strong>APPROVED</strong> -- Reviewer approves, queued for next run</div>
                            </div>
                            <div class="flow-step">
                                <div class="flow-num flow-applied">OK</div>
                                <div class="flow-text"><strong>APPLIED</strong> -- Strategy rebuilt with new parameters</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Performance Metrics -->
                <section class="docs-section">
                    <h2 class="docs-heading">Performance Metrics</h2>
                    <div class="card docs-card">
                        <table class="docs-param-table">
                            <tr><th>Metric</th><th>Formula</th><th>Good Value</th></tr>
                            <tr><td><strong>Sharpe Ratio</strong></td><td>mean_return / std_return * sqrt(periods)</td><td>&gt; 1.0</td></tr>
                            <tr><td><strong>Sortino Ratio</strong></td><td>mean_return / downside_std * sqrt(periods)</td><td>&gt; 1.5</td></tr>
                            <tr><td><strong>Max Drawdown</strong></td><td>Worst peak-to-trough decline</td><td>&gt; -20%</td></tr>
                            <tr><td><strong>Profit Factor</strong></td><td>gross_profit / gross_loss</td><td>&gt; 1.5</td></tr>
                            <tr><td><strong>Win Rate</strong></td><td>winning_trades / total_trades</td><td>&gt; 50%</td></tr>
                            <tr><td><strong>VaR 95%</strong></td><td>5th percentile of return distribution</td><td>Small negative</td></tr>
                            <tr><td><strong>Omega Ratio</strong></td><td>sum(gains) / sum(losses)</td><td>&gt; 1.0</td></tr>
                        </table>

                        <h3 class="docs-subheading">Crypto Annualization</h3>
                        <p>Crypto trades 24/7, so annualization periods differ from traditional finance:</p>
                        <ul class="docs-list">
                            <li><strong>Hourly data:</strong> multiply by sqrt(8,760) -- 365 days * 24 hours</li>
                            <li><strong>Daily data:</strong> multiply by sqrt(365)</li>
                            <li><strong>Minute data:</strong> multiply by sqrt(525,600)</li>
                        </ul>
                    </div>
                </section>

                <!-- Backtesting -->
                <section class="docs-section">
                    <h2 class="docs-heading">Backtesting Engine</h2>
                    <div class="card docs-card">
                        <p>The backtesting engine supports two modes for validating strategies against historical data.</p>

                        <h3 class="docs-subheading">Formula-Based (GeneticAlpha)</h3>
                        <p>Express strategies as string formulas that are automatically optimized:</p>
                        <pre class="docs-code">ls_10/90(logret_1())                       # Momentum: long winners, short losers
ls_10/90(div(logret_1(),volatility_25()))  # Risk-adjusted momentum
mac_10/30(close)                           # Moving average crossover
ls_20/80(minus(close,mean_20(close)))      # Mean reversion</pre>

                        <h3 class="docs-subheading">Strategy-Based (Alpha Engine)</h3>
                        <p>Full Python strategies with custom indicators and logic:</p>
                        <pre class="docs-code">python scripts/run_backtest.py --strategy momentum --tickers BTC ETH SOL --hours 720
python scripts/run_backtest.py --formula "ls_10/90(logret_1())" --tickers BTC ETH --hypothesis
python scripts/run_backtest.py --builtin-only --tickers BTC SOL ETH XRP HYPE --hours 168</pre>

                        <h3 class="docs-subheading">Hypothesis Testing</h3>
                        <p>Monte Carlo permutation tests validate whether backtested performance is real or data-mined:</p>
                        <table class="docs-param-table">
                            <tr><th>Test</th><th>Question</th><th>p &lt; 0.05 means</th></tr>
                            <tr><td><code>timer_p</code></td><td>Can we time entry/exit better than random?</td><td>Timing skill is real</td></tr>
                            <tr><td><code>picker_p</code></td><td>Can we select assets better than random?</td><td>Selection skill is real</td></tr>
                            <tr><td><code>trader_p1</code></td><td>Are trading decisions better than random?</td><td>Trading edge exists</td></tr>
                            <tr><td><code>trader_p2</code></td><td>Is the edge robust to permutations?</td><td>Not data-mined</td></tr>
                        </table>
                    </div>
                </section>

                <!-- Implementation Guide -->
                <section class="docs-section">
                    <h2 class="docs-heading">Implementation Guide</h2>
                    <div class="card docs-card">
                        <h3 class="docs-subheading">Adding a New Strategy</h3>
                        <ol class="docs-list docs-list-numbered">
                            <li>Create a class extending <code>BaseStrategy</code> in <code>scripts/paper_trading/strategies/</code></li>
                            <li>Implement <code>generate_recommendations()</code> returning a list of <code>Recommendation</code> objects</li>
                            <li>Register the strategy in <code>scheduler.py</code></li>
                            <li>Add parameter bounds in <code>strategy_tuner.py</code> for auto-tuning</li>
                            <li>Add a strategy card to this dashboard</li>
                        </ol>

                        <h3 class="docs-subheading">Key Files</h3>
                        <table class="docs-param-table">
                            <tr><th>File</th><th>Purpose</th></tr>
                            <tr><td><code>scripts/paper_trading/scheduler.py</code></td><td>APScheduler orchestrator -- runs all jobs</td></tr>
                            <tr><td><code>scripts/paper_trading/base_strategy.py</code></td><td>BaseStrategy ABC + Recommendation dataclass</td></tr>
                            <tr><td><code>scripts/paper_trading/strategy_tuner.py</code></td><td>Self-adjusting parameter tuner</td></tr>
                            <tr><td><code>scripts/paper_trading/metrics_calculator.py</code></td><td>Aggregated metrics for Supabase</td></tr>
                            <tr><td><code>scripts/run_backtest.py</code></td><td>CLI backtest runner</td></tr>
                            <tr><td><code>integrations/quantpylib/</code></td><td>QuantPyLib bridge (data, backtesting, metrics)</td></tr>
                        </table>

                        <h3 class="docs-subheading">Running the System</h3>
                        <pre class="docs-code"># Start the full paper trading system
python -m scripts.paper_trading.scheduler

# Run strategies once (no loop)
python -m scripts.paper_trading.scheduler --once

# Run auto-tuner manually
python -m scripts.paper_trading.scheduler --tune

# Review pending parameter adjustments
python -m scripts.paper_trading.scheduler --tune-review</pre>
                    </div>
                </section>

            </div>
        </div><!-- end tab-docs -->

        <!-- Footer -->
        <footer class="footer">
            <p>Paper Trading System - For educational purposes only. Not financial advice.</p>
            <p>Data refreshes every 60 seconds. All times in UTC.</p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
